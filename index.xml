<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Blog</title><link>https://valh.io/</link><description>Recent content on Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 20 May 2022 18:24:29 +0000</lastBuildDate><atom:link href="https://valh.io/index.xml" rel="self" type="application/rss+xml"/><item><title>Android TV Cheat Sheet</title><link>https://valh.io/p/android-tv-cheat-sheet/</link><pubDate>Fri, 20 May 2022 18:24:29 +0000</pubDate><guid>https://valh.io/p/android-tv-cheat-sheet/</guid><description>
&lt;p>Recently, I ventured further into the world of Android TV using Android 11 on a &lt;a href="https://www.mi.com/global/product/xiaomi-tv-stick-4k/">Xiaomi TV Stick 4K&lt;/a>. In this post I&amp;rsquo;ll share some insights to get the most out of your Android TV.&lt;/p>
&lt;p>Keep in mind that not all of these might work the same way or at all on any Android TV device! Most of them should, though. When in doubt, try and search for your device&amp;rsquo;s name and what you&amp;rsquo;re trying to do.&lt;/p>
&lt;p>My main focus is to enable a customized, ad-free experience as well as to document quirks that I&amp;rsquo;ve encountered.&lt;/p>
&lt;p>Note that some of the following things can be achieved by various means. For example, installing custom apps is also possible through certain third-party downloader apps. I&amp;rsquo;m focussing on achieving everything without third-party tools, notably the Android Debug Bridge (adb) which provides a command line interface for interacting with Android devices. It comes with an initial learning curve but enables many more possibilities in the long-run and is usable across devices without relying on third parties.&lt;/p>
&lt;h1 id="managing-the-device-with-adb">Managing the device with adb&lt;/h1>
&lt;h2 id="getting-adb">Getting adb&lt;/h2>
&lt;p>Download the Android platform tools for your OS &lt;a href="https://developer.android.com/studio/releases/platform-tools">here&lt;/a>. The zip file contains an executable &lt;code>adb&lt;/code> among other things.&lt;/p>
&lt;p>Having unzipped the archive, move into it&amp;rsquo;s content using your CLI - in my case Bash on Linux.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> platform-tools
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./adb version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You should see output stating the adb version you have now.&lt;/p>
&lt;h2 id="activating-debug-access-on-android-tv">Activating debug access on Android TV&lt;/h2>
&lt;p>Now, you need to allow debug access on your Android TV. To access the corresponding setting, you need to enable &lt;code>Developer options&lt;/code>, which are hidden behind a little trick in Android.&lt;/p>
&lt;p>Open &lt;code>Settings&lt;/code> -&amp;gt; &lt;code>Device preferences&lt;/code> and move to a section called &lt;code>About [device]&lt;/code> or similar. In here you&amp;rsquo;ll find various information like Android version, device model and also &lt;strong>Android TV OS build&lt;/strong>. Tap/click on this a few times until a message appears on the bottom of the screen. It should tell you to press a few more times to activate &lt;code>Developer options&lt;/code>.&lt;/p>
&lt;p>Once &lt;code>Developer options&lt;/code> are activated you should see them as a category when opening &lt;code>Settings&lt;/code> -&amp;gt; &lt;code>Device preferences&lt;/code>. Move into &lt;code>Developer options&lt;/code>, scroll down to &lt;code>USB debugging&lt;/code> and activate it.&lt;/p>
&lt;p>You can connect with adb through USB but I recommend using the wireless network, because it&amp;rsquo;s much easier once you&amp;rsquo;ve gotten the hang of it. Some devices (especially devices in &amp;ldquo;Stick&amp;rdquo; format) don&amp;rsquo;t even have USB ports anymore or you need a special cable.&lt;/p>
&lt;h2 id="connecting-to-android-tv-with-adb">Connecting to Android TV with adb&lt;/h2>
&lt;p>Next, you need to find out the IP address of your Android TV device.&lt;/p>
&lt;p>In Android TV the IP address can be found in &lt;code>Settings&lt;/code> -&amp;gt; &lt;code>Device preferences&lt;/code> -&amp;gt; &lt;code>About&lt;/code> -&amp;gt; &lt;code>Status&lt;/code>. Your router&amp;rsquo;s web interface should also have it somewhere.&lt;/p>
&lt;p>Once you have the IP address of your device (in my case 192.168.178.10), run the following command to connect with adb. Make sure to use your device&amp;rsquo;s actual IP address when copy-pasting:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">adb connect 192.168.178.10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>adb might say something like &lt;code>Failed to authenticate [...]&lt;/code>. If that happens, look at your TV screen. You should see a pop-up window, asking you to click &lt;code>OK&lt;/code> to allow access. This is a security feature to make sure not anyone can access your Android TV through adb just because they&amp;rsquo;re in your network.&lt;/p>
&lt;p>After having allowed access, run the following to check whether the connection was established:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">adb devices
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It should put out a &lt;code>List of devices attached&lt;/code> with one element: Your device&amp;rsquo;s IP address.&lt;/p>
&lt;p>&lt;strong>Note&lt;/strong>, that it is considered a &lt;strong>security risk&lt;/strong> to leave ADB debugging activated on Android &lt;em>permanently&lt;/em>. It&amp;rsquo;s highly encouraged to deactivate it when you&amp;rsquo;re done and only re-activate when needed.&lt;/p>
&lt;h1 id="ad-free-youtube">Ad-free YouTube&lt;/h1>
&lt;p>&lt;code>SmartTubeNext&lt;/code> is an amazing third-party YouTube client for TVs. It&amp;rsquo;s ad-free and contains many more comfort features like SponsorBlock. It&amp;rsquo;s also highly customizable - I thoroughly recommend it.&lt;/p>
&lt;p>You can find it&amp;rsquo;s code and get the APK file needed for installation &lt;a href="https://github.com/yuliskov/SmartTubeNext">on GitHub&lt;/a>.&lt;/p>
&lt;p>Scroll down to &lt;code>latest stable download&lt;/code> and download the linked file.&lt;/p>
&lt;p>&lt;a href="#managing-the-device-with-adb">Having connected to your device using adb&lt;/a>, you can install the APK file as follows:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">adb install smarttube_stable.apk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Make sure that the filename is correct and execute it.&lt;/p>
&lt;h1 id="ad-free-launcher">Ad-free launcher&lt;/h1>
&lt;p>(Most) Android TV devices come with the standard Google Launcher as default. It&amp;rsquo;s looking slick but is unfortunately full of ads - not exactly what you might expect from &lt;strong>your device&lt;/strong>, that you bought with &lt;strong>your money&lt;/strong>.&lt;/p>
&lt;p>Luckily there are many ad-free launchers out there that you can just install instead. A big name mentioned in many places would be &amp;ldquo;ATV Launcher&amp;rdquo;, which is well established and has many features.&lt;/p>
&lt;p>ATV launcher&amp;rsquo;s design was a bit too crowded for my taste, some features require the paid version and it&amp;rsquo;s proprietary afaik.&lt;/p>
&lt;p>If you don&amp;rsquo;t care about lots of widgets and are simply looking for a free, slick and &lt;strong>open source&lt;/strong> launcher, I highly recommend &lt;code>FLauncher&lt;/code>. It&amp;rsquo;s source code can be found &lt;a href="https://gitlab.com/etienn01/flauncher">on GitLab&lt;/a>.&lt;/p>
&lt;p>You can install it from the &lt;a href="https://play.google.com/store/apps/details?id=me.efesser.flauncher&amp;amp;hl=en&amp;amp;gl=US">Play Store&lt;/a>.&lt;/p>
&lt;p>If you want to set a custom background image in FLauncher, check the chapter on &lt;a href="#upload-files-onto-android-tv">uploading files onto Android TV&lt;/a>. Once your desired image is in the file system, you can easily set it as background image in FLauncher&amp;rsquo;s settings.&lt;/p>
&lt;h1 id="upload-files-onto-android-tv">Upload files onto Android TV&lt;/h1>
&lt;p>&lt;a href="#managing-the-device-with-adb">Having connected to your device using adb&lt;/a>, you can push local files to Android TV as follows:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">adb push my-local-image.png /sdcard/Pictures/my-remote-image.png
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Note&lt;/strong>, that &lt;code>/sdcard&lt;/code> represents the part of Android&amp;rsquo;s file system sometimes referred to as &amp;ldquo;internal SD card&amp;rdquo;. It&amp;rsquo;s basically the space where user data (Pictures, Music, Downloads, &amp;hellip;) exists, which is why you usually want to put your files there.&lt;/p>
&lt;h1 id="custom-functions-for-physical-remote-buttons">Custom functions for physical remote buttons&lt;/h1>
&lt;p>Some Android TV devices come with physical remotes that exhibit buttons with weird functions - for instance my Xiaomi TV stick has a button that start&amp;rsquo;s a non-removable pre-installed app that doesn&amp;rsquo;t even work. With &lt;code>Button Mapper&lt;/code> you can change what most of these buttons do (&amp;ldquo;remap&amp;rdquo; them).&lt;/p>
&lt;p>This is also very helpful when using a custom launcher (&lt;a href="#ad-free-launcher">see above&lt;/a> to find out which one I recommend), because the home button (at least in my case) can be hard-wired to start the Google launcher and not another one which you might&amp;rsquo;ve set as default. In Button Mapper, just choose your home button and modify it to start an app - your desired launcher.&lt;/p>
&lt;p>You can find Button Mapper &lt;a href="https://play.google.com/store/apps/details?id=flar2.homebutton&amp;amp;hl=en&amp;amp;gl=US">in the Play Store&lt;/a> and install it directly on your Android TV device.&lt;/p>
&lt;p>Setting it up is self-explanatory so I won&amp;rsquo;t go into much detail here. Note, that some buttons might not be changeable - the premium version promises to allow for more buttons to be modified but I didn&amp;rsquo;t try it yet.&lt;/p>
&lt;h1 id="volume-too-low-or-too-high--changing-volume-without-remote">Volume too low or too high / Changing volume without remote&lt;/h1>
&lt;p>This was a funny one: Xiaomi&amp;rsquo;s TV Stick comes with a remote which automatically configures itself to control your TV as well. That&amp;rsquo;s very handy, because you only need one remote to turn your TV on/off, change the volume and navigate through Android TV at the same time.&lt;/p>
&lt;p>Unfortunately, I&amp;rsquo;ve found the sound of any media playing through Android TV to be &lt;strong>really&lt;/strong> quiet. I&amp;rsquo;ve had to put my TV on 100% volume to hear anything. For any other device 20% was more than enough.&lt;/p>
&lt;p>The problem was that Android TV also has it&amp;rsquo;s own volume level - like any other Android device. The remote wasn&amp;rsquo;t changing that one though, because it was changing the TV&amp;rsquo;s volume instead.&lt;/p>
&lt;p>So there are two volume levels to be adjusted but the remote can only change one. It is most likely possible to un-pair the Android TV remote and TV, turn Android&amp;rsquo;s volume up and pair the remote again but I find the following way to be much quicker.&lt;/p>
&lt;p>With the following adb commands, we get a shell on Android TV and then simulate &amp;ldquo;volume up&amp;rdquo; button presses. I just did this a few times until the volume was on max and left it there. You should see a volume bar appear in Android TV, when you execute one of the &lt;code>input&lt;/code> commands.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Get a shell on your Android TV&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb shell
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Send a volume up key event&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">input keyevent &lt;span class="m">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Send a volume down key event&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">input keyevent &lt;span class="m">25&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Thanks to ce4 on &lt;a href="https://android.stackexchange.com/questions/25828/how-can-i-remotely-change-the-volume">Android StackExchange&lt;/a> for documenting this!&lt;/p>
&lt;p>There is another, arguably more elegant way to do this using the &lt;code>media&lt;/code> command in the adb shell. It allows you to directly set the volume to your desired value. I couldn&amp;rsquo;t find a &lt;code>media&lt;/code> executable on my device though so I&amp;rsquo;m just documenting it for the sake of completeness. You can find a good example on &lt;a href="https://stackoverflow.com/questions/21055947/adb-command-to-set-volume">StackOverflow&lt;/a>.&lt;/p></description></item><item><title>Raspberry Pi: Configure WLAN/WiFi + SSH before first boot</title><link>https://valh.io/p/raspberry-pi-configure-wlan/wifi--ssh-before-first-boot/</link><pubDate>Sun, 15 May 2022 14:03:59 +0000</pubDate><guid>https://valh.io/p/raspberry-pi-configure-wlan/wifi--ssh-before-first-boot/</guid><description>
&lt;p>Lots of Raspberry Pis are used for purposes that require a wireless network connection and remote access. To save time otherwise spent on connecting the Pi to a screen and keyboard or wired network to configure this, you can just configure network, SSH and an initial user before the first boot.&lt;/p>
&lt;p>This post documents an interactive and a non-interactive approach.&lt;/p>
&lt;h1 id="interactively-with-raspberry-pi-imager">Interactively with Raspberry Pi Imager&lt;/h1>
&lt;p>The Raspberry Pi Foundation provides an imaging tool, allowing you to not only flash the current Raspberry Pi OS to a given device but also to configure a few things in the same step.&lt;/p>
&lt;p>You can find it &lt;a href="https://www.raspberrypi.com/software/">here&lt;/a>.&lt;/p>
&lt;p>The tool is quite self-explanatory, so I won&amp;rsquo;t go into much detail here.&lt;/p>
&lt;p>Select the source image and destination in the tool, click the “settings” button – the picture of a cogwheel – before clicking “Write”, and use the Advanced options menu to enter a username and password, along with any other preconfiguration you want.&lt;/p>
&lt;p>Put the flashed micro SD card into your Pi, boot it up and enjoy!&lt;/p>
&lt;h1 id="non-interactively-with-config-files">Non-interactively with config files&lt;/h1>
&lt;p>If you don&amp;rsquo;t want to use the official imaging tool or you want to keep a set of config files to use often, here is another non-interactive approach.&lt;/p>
&lt;p>To flash the image, you can use the official Imager, another interactive tool like &lt;a href="https://www.balena.io/etcher/">Etcher&lt;/a> or a &lt;a href="https://www.raspberrypi.com/documentation/computers/getting-started.html#installing-images-on-linux">CLI tool like &lt;code>dd&lt;/code>&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Having flashed the Raspberry Pi OS image onto your Pi&lt;/strong>, use your file explorer or terminal to move to a newly created partition called &lt;code>boot&lt;/code> on the micro SD card.&lt;/p>
&lt;h2 id="initial-user-mandatory">Initial user (mandatory)&lt;/h2>
&lt;p>Since 2022, Raspberry Pi OS doesn&amp;rsquo;t come with the well-known default user &lt;code>pi&lt;/code> anymore. Instead, it asks you to create a user yourself on first boot interactively.&lt;/p>
&lt;p>To create a user automatically on first boot, you have to provide a file &lt;code>userconf&lt;/code> containing your desired user and password in the &lt;code>boot&lt;/code> partition.&lt;/p>
&lt;p>The file must contain your username and encrypted password like so:&lt;/p>
&lt;pre tabindex="0">&lt;code>username:encrypted-password
&lt;/code>&lt;/pre>&lt;p>Make sure you are in the boot partition and use the following command, replacing &lt;code>myuser&lt;/code> and &lt;code>mypassword&lt;/code>, to create the file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;myuser:&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;mypassword&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> openssl passwd -6 -stdin&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &amp;gt; userconf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For example, the combination &lt;code>myuser&lt;/code> and &lt;code>mypassword&lt;/code> should look like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ cat userconf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">myuser:&lt;span class="nv">$6$e1HRSQqoAr3UL0M8$nvsMz1SHlraA1R&lt;/span>.2FZwbAq3CnM743E9.DZqBOYtnS317TaNbMoPM3OPskUmiTWUFwT.2y5k2FM7HrufRGi2Nr/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you&amp;rsquo;re on Windows, make sure that &lt;code>userconf&lt;/code> doesn&amp;rsquo;t have any other extension such as &lt;em>.txt&lt;/em>.&lt;/p>
&lt;h2 id="wlan">WLAN&lt;/h2>
&lt;p>Create a file called &lt;code>wpa_supplicant.conf&lt;/code> in the root of the &lt;code>boot&lt;/code> partition and paste the contents corresponding to the WPA version you&amp;rsquo;re using.&lt;/p>
&lt;p>If you&amp;rsquo;re on Windows, make sure that &lt;code>wpa_supplicant.conf&lt;/code> doesn&amp;rsquo;t have any other extension such as &lt;em>.txt&lt;/em>.&lt;/p>
&lt;p>Change the &lt;em>country&lt;/em> parameter as well as the &lt;em>ssid&lt;/em> and &lt;em>psk&lt;/em> accordingly and save the file:&lt;/p>
&lt;h3 id="wpa3--wpa2-mixed-network">WPA3 / WPA2 mixed network&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US
network={
ssid=&amp;#34;Your network name/SSID&amp;#34;
psk=&amp;#34;Your WPA security key&amp;#34;
key_mgmt=WPA-PSK-SHA256
ieee80211w=2
}
&lt;/code>&lt;/pre>&lt;h3 id="wpa2-only-network">WPA2-only network&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US
network={
ssid=&amp;#34;Your network name/SSID&amp;#34;
psk=&amp;#34;Your WPA security key&amp;#34;
key_mgmt=WPA-PSK
}
&lt;/code>&lt;/pre>&lt;h2 id="ssh">SSH&lt;/h2>
&lt;p>Create an empty file simply called &lt;code>ssh&lt;/code> in the &lt;code>boot&lt;/code> partition. If you&amp;rsquo;re on Windows, make sure that &lt;code>ssh&lt;/code> doesn&amp;rsquo;t have any other extension such as &lt;em>.txt&lt;/em>.&lt;/p>
&lt;h2 id="first-boot">First boot&lt;/h2>
&lt;p>Once all the files are saved, eject the SD card safely, put it in your Pi and boot it up. You should be able to connect via SSH using the user and password you&amp;rsquo;ve set before shortly after.&lt;/p></description></item><item><title>Windows Auto Dark Mode - Change multi-screen wallpaper</title><link>https://valh.io/p/windows-auto-dark-mode-change-multi-screen-wallpaper/</link><pubDate>Fri, 06 May 2022 14:43:17 +0000</pubDate><guid>https://valh.io/p/windows-auto-dark-mode-change-multi-screen-wallpaper/</guid><description>
&lt;h1 id="the-tool">The tool&lt;/h1>
&lt;p>&lt;strong>AutoDarkMode&lt;/strong> is a great open source tool to automatically switch between dark and light themes on Windows. You can set custom hours, switch manually or use sunset and sunrise from your location.&lt;/p>
&lt;p>You can download it and contribute &lt;a href="https://github.com/AutoDarkMode/Windows-Auto-Night-Mode">here on GitHub&lt;/a>.&lt;/p>
&lt;p>It can also change your wallpaper to a light or dark one - &lt;em>but only on one screen&lt;/em>. Since I have a dual screen setup and a soft spot for ultra-wide wallpapers, there had to be a way!&lt;/p>
&lt;p>Luckily, AutoDarkMode can call custom scripts on a light/dark switch event. With a simple PowerShell script, which I have adapted from a PowerShell function shared by &lt;a href="https://www.joseespitia.com/2017/09/15/set-wallpaper-powershell-function/">Jose Espitia&lt;/a>, we can set a given file as wallpaper in a certain mode (span in my case).&lt;/p>
&lt;h1 id="download-set-windows-wallpaper-script">Download set-windows-wallpaper script&lt;/h1>
&lt;p>The script can be found &lt;a href="https://github.com/va1entin/tools/tree/master/set-windows-wallpaper">on GitHub&lt;/a>. You can clone the repo or download the file directly &lt;a href="https://raw.githubusercontent.com/va1entin/tools/master/set-windows-wallpaper/set-windows-wallpaper.ps1">here&lt;/a> (right-click -&amp;gt; save as).&lt;/p>
&lt;p>Once downloaded, put the script into the location you want to keep it in permanently. This can be any folder you like really. I&amp;rsquo;ve put it into &lt;code>Documents&lt;/code>.&lt;/p>
&lt;p>The script can also set wallpapers in other modes - feel free to have a look into it, if you&amp;rsquo;re interested in that.&lt;/p>
&lt;h1 id="change-powershell-executionpolicy">Change Powershell ExecutionPolicy&lt;/h1>
&lt;p>To run custom scripts, you need to change Powershell&amp;rsquo;s ExecutionPolicy. Start a Powershell as admin and run the following, answering &lt;code>[Y]&lt;/code> when asked whether changes shall be made:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">Set-ExecutionPolicy&lt;/span> &lt;span class="n">-ExecutionPolicy&lt;/span> &lt;span class="n">RemoteSigned&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>At this point you may test whether the script works. Run the following in Powershell. Make sure to adapt the path to the script and image to your setup.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Documents&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="nb">set-windows&lt;/span>&lt;span class="n">-wallpaper&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ps1&lt;/span> &lt;span class="o">-File&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Pictures&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Wallpaper&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="nb">wallpaper-day&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">jpg&lt;/span> &lt;span class="n">-Style&lt;/span> &lt;span class="n">Span&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="configure-autodarkmode-to-run-script">Configure AutoDarkMode to run script&lt;/h1>
&lt;p>With the script in place and running successfully, you can configure AutoDarkMode to run it. Right-click on the AutoDarkMode icon in the system tray and click &lt;strong>Open config directory&lt;/strong>.&lt;/p>
&lt;p>In the config directory, open the file &lt;code>scripts.yaml&lt;/code> and add the following to it. The file should already contain an example for a script. You can just delete that or comment it out for reference.&lt;/p>
&lt;p>Make sure to replace the paths to the script and your desired light and dark images!&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Component&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TimeoutMillis&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Scripts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Span wallpaper change&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Powershell&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ArgsLight&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="l">C:\Users\val\Documents\set-windows-wallpaper.ps1, -File, C:\Users\val\Pictures\Wallpaper\wallpaper-day.jpg, -Style, Span]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ArgsDark&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="l">C:\Users\val\Documents\set-windows-wallpaper.ps1, -File, C:\Users\val\Pictures\Wallpaper\wallpaper-night.jpg, -Style, Span]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">AllowedSources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="l">Any]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>See the &lt;a href="https://github.com/AutoDarkMode/Windows-Auto-Night-Mode/wiki/How-to-add-custom-scripts">AutoDarkMode wiki&lt;/a> for reference on adding custom scripts.&lt;/p>
&lt;h1 id="test-it">Test it&lt;/h1>
&lt;p>Now, you can test the script through AutoDarkMode by forcing a switch to the light and dark theme. Right-click on the AutoDarkMode icon in system tray and click the corresponding command. Your span wallpaper should change as configured.&lt;/p>
&lt;p>If it doesn&amp;rsquo;t, make sure that the script works when run directly and that the config in &lt;code>scripts.yaml&lt;/code> is correct. You can also consult the &lt;code>service.log&lt;/code> file written by AutoDarkMode. It was very helpful in developing this script!&lt;/p></description></item><item><title>Workaround for broken DNS in WSL2</title><link>https://valh.io/p/workaround-for-broken-dns-in-wsl2/</link><pubDate>Fri, 29 Apr 2022 12:34:45 +0000</pubDate><guid>https://valh.io/p/workaround-for-broken-dns-in-wsl2/</guid><description>
&lt;p>WSL2 uses the Windows host&amp;rsquo;s DNS - so if DNS is working on Windows, normally WSL2 should be fine as well! Unfortunately, DNS in WSL2 just randomly stopped working for me at some point. The &lt;code>/etc/resolv.conf&lt;/code> file generated by WSL2 was still being correctly created but DNS just wouldn&amp;rsquo;t work.&lt;/p>
&lt;p>Luckily there are plenty of ways to work around this, because we can just do DNS ourselves inside the Linux running in WSL2.&lt;/p>
&lt;h1 id="prerequisite-deactivate-auto-generation-of-etcresolvconf">Prerequisite: Deactivate auto-generation of &lt;code>/etc/resolv.conf&lt;/code>&lt;/h1>
&lt;p>For any of the following scenarios we need to stop WSL2 from writing to &lt;code>/etc/resolv.conf&lt;/code> first, because we need to persistently modify it.&lt;/p>
&lt;p>In WSL2, open a file &lt;code>/etc/wsl.conf&lt;/code>, paste the following content and save:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>network&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">generateResolvConf&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you also want to stop WSL2 from overwriting your &lt;code>/etc/hosts.conf&lt;/code>, you need to add another line like so:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">generateHosts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>To have these changes take effect, you need to restart WSL2. Close your WSL2 window, start PowerShell as admin and run the following command to shutdown WSL2.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">wsl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">exe&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="n">-shutdown&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://github.com/microsoft/WSL/issues/5611#issuecomment-661272808">See here&lt;/a> for reference, if you want to know in detail why this is necessary.&lt;/p>
&lt;p>After the command has finished successfully, you can start WSL2 again.&lt;/p>
&lt;p>Back in WSL, remove the broken DNS configuration file that WSL leaves behind.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">rm /etc/resolv.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Next, we&amp;rsquo;ll set up DNS inside Linux. There are multiple ways of varying complexity depending on your use case.&lt;/p>
&lt;h1 id="one-remote-dns-server">One remote DNS server&lt;/h1>
&lt;p>If you just need to use one DNS server like a public DNS or a server provided by your organization that can resolve everything you need, this is the most simple setup.&lt;/p>
&lt;p>In WSL2, open the file &lt;code>/etc/resolv.conf&lt;/code>, paste the following content and save:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nameserver &amp;lt;your dns server&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you wanted to use CloudFlare&amp;rsquo;s public DNS for example, it&amp;rsquo;d look like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nameserver 1.1.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="multiple-remote-dns-servers">Multiple remote DNS servers&lt;/h1>
&lt;p>If you need to use multiple DNS servers, you&amp;rsquo;ll have to setup your own DNS server, which in turn uses the remote DNS servers you need. Don&amp;rsquo;t worry, it&amp;rsquo;s easy!&lt;/p>
&lt;p>For example, in my WSL2 Ubuntu environment I need to use a specific DNS server for an internal domain and a public DNS for everything else.&lt;/p>
&lt;h2 id="install-dns-server-software-dnsmasq">Install dns server software &lt;strong>dnsmasq&lt;/strong>&lt;/h2>
&lt;p>Firstly, install the dns server &lt;strong>dnsmasq&lt;/strong>. You might need to use a different package manager depending on your Linux distro. This works on Ubuntu and other Debian-based distros:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo apt install -y dnsmasq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="configure-dnsmasq">Configure dnsmasq&lt;/h2>
&lt;p>After dnsmasq has been installed, open it&amp;rsquo;s config file &lt;code>/etc/dnsmasq.conf&lt;/code>, add the following and save.&lt;/p>
&lt;p>dnsmasq comes with a big config file full of deactivated settings as reference. If you want to keep all that, that&amp;rsquo;s no problem - I did it as well and just appended the following:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">server&lt;/span>&lt;span class="o">=&lt;/span>/&amp;lt;your internal domain&amp;gt;/&amp;lt;your internal DNS server&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">server&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;your external DNS server&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">no-dhcp-interface&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>&amp;lt;your internal DNS server&amp;gt;&lt;/code> will only be used for domains under &lt;code>&amp;lt;your internal domain&amp;gt;&lt;/code>. You can add as many of these as you want, if you have multiple internal domains for example.&lt;/p>
&lt;p>&lt;code>&amp;lt;your external DNS server&amp;gt;&lt;/code> is the public DNS server and will be used for everything else.&lt;/p>
&lt;p>&lt;code>no-dhcp-interface=&lt;/code> deactives the DHCP and TFTP capabilities of dnsmasq, because we only want it to provide DNS.&lt;/p>
&lt;p>So if I have an internal domain called &lt;code>mycompany.internal&lt;/code>, an internal DNS server &lt;code>192.168.1.53&lt;/code> and the public CloudFlare DNS &lt;code>1.1.1.1&lt;/code>, it&amp;rsquo;d look like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">server&lt;/span>&lt;span class="o">=&lt;/span>/mycompany.internal/192.168.1.53
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">server&lt;/span>&lt;span class="o">=&lt;/span>1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">no-dhcp-interface&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Finally, start dnsmasq&amp;hellip;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo service dnsmasq start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;hellip;and check whether it started successfully.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo service dnsmasq status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="get-dnsmasq-ip-address">Get dnsmasq ip address&lt;/h2>
&lt;p>Now that we have installed, configured and started dnsmasq, we need to configure our Linux to use it as for DNS. We need to find the IP address that dnsmasq is listening on first.&lt;/p>
&lt;p>This can be accomplished with &lt;code>netstat&lt;/code>, which you can install with the package &lt;code>net-tools&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt install -y net-tools
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This command gives us the IPs that any running instances of dnsmasq are listening on:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo netstat -tulpen &lt;span class="p">|&lt;/span> grep dnsmasq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If there is not output, make sure dnsmasq is up and running. If its not running, check for errors in the config file.&lt;/p>
&lt;h2 id="set-dnsmasq-as-dns-server-to-be-used">Set dnsmasq as DNS server to be used&lt;/h2>
&lt;p>Open &lt;code>/etc/resolv.conf&lt;/code> and add the IP you&amp;rsquo;ve just found. In my case it was &lt;code>127.0.0.53&lt;/code> but it can also be &lt;code>0.0.0.0&lt;/code>.&lt;/p>
&lt;p>If it is &lt;code>0.0.0.0&lt;/code> just put &lt;code>127.0.0.1&lt;/code> as IP here.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nameserver 127.0.0.53
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Save the file to start using dnsmasq as DNS server.&lt;/p>
&lt;h2 id="start-dnsmasq-automatically-at-wsl-start-hacky">Start dnsmasq automatically at WSL start (hacky)&lt;/h2>
&lt;p>Since WSL2 is not a real Linux, we can&amp;rsquo;t use systemd or similar &lt;em>good ways&lt;/em> to automatically start our newly configured DNS server &lt;em>for now&lt;/em> (systemd is supposed to be added to Ubuntu WSL in the future).&lt;/p>
&lt;p>I didn&amp;rsquo;t dig for a perfect solution here tbh, because I&amp;rsquo;m using Windows and WSL2 involuntarily.&lt;/p>
&lt;p>That&amp;rsquo;s why I just wrote a tiny Shell script which checks whether dnsmasq is running and, if it doesn&amp;rsquo;t, starts it. This runs every time I open a shell in WSL2.&lt;/p>
&lt;p>It&amp;rsquo;s not pretty and in a real Linux environment I&amp;rsquo;d never do it this way but for this specific use-case it&amp;rsquo;s totally fine imho.&lt;/p>
&lt;p>Open your &lt;code>~/.bashrc&lt;/code> and &lt;strong>append&lt;/strong> the following at the end of the file. If you&amp;rsquo;re using a different shell, such as &lt;strong>ZSH&lt;/strong>, use the corresponding rc file like &lt;code>~/.zshrc&lt;/code> instead of &lt;code>~/.bashrc&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">service dnsmasq status &amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$?&lt;/span> -eq &lt;span class="m">3&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Dnsmasq not running, please provide sudo pw to start it...&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> sudo service dnsmasq start&lt;span class="p">;&lt;/span> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Next time you start a shell, you&amp;rsquo;ll be prompted to enter your password to start dnsmasq, if it&amp;rsquo;s not yet running.&lt;/p></description></item><item><title>Fix silently failing Docker Desktop upgrade (Windows)</title><link>https://valh.io/p/fix-silently-failing-docker-desktop-upgrade-windows/</link><pubDate>Sat, 26 Jun 2021 12:22:28 +0000</pubDate><guid>https://valh.io/p/fix-silently-failing-docker-desktop-upgrade-windows/</guid><description>
&lt;p>Docker Desktop has an internal update mechanism which will, as soon as an update is available, begin asking you to apply it on every start. Unfortunately this update mechanism is not working properly for me and other users. Once you allow Docker Desktop to run the update with admin privileges nothing seems to happen and Docker also doesn&amp;rsquo;t start properly until you restart it manually.&lt;/p>
&lt;p>The cause seems to be some kind of privilege problem with the Docker service running in the background. Here is a workaround that works nicely for me.&lt;/p>
&lt;h1 id="stop-docker-service">Stop docker service&lt;/h1>
&lt;p>Start a command line such as PowerShell as admin and run the following command to stop the docker service (this will stop any running containers!)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">com&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="run-installer">Run installer&lt;/h1>
&lt;p>Download the most recent version of Docker Desktop from &lt;a href="https://www.docker.com/products/docker-desktop">docker.com&lt;/a> and run the installer, once the previous step was executed successfully.&lt;/p>
&lt;p>The update should work now.&lt;/p></description></item><item><title>Sync system time automatically at Windows startup</title><link>https://valh.io/p/sync-system-time-automatically-at-windows-startup/</link><pubDate>Sat, 19 Jun 2021 17:22:45 +0000</pubDate><guid>https://valh.io/p/sync-system-time-automatically-at-windows-startup/</guid><description>
&lt;p>&lt;strong>Update&lt;/strong>: The Windows time sync service is not working reliably. It was working fine on my system for a few months but stopped syncing time properly eventually even though it is still being started automatically. Feel free to give it a try nonetheless but know that this seems to be another one of Windows&amp;rsquo; great unreliable mysteries&amp;hellip;&lt;/p>
&lt;p>Unlike most other operating systems, Windows 10 doesn&amp;rsquo;t sync the time with an internet service at startup by default. This can become an issue, if your mainboard&amp;rsquo;s built-in clock provides a wrong time or uses a different time zone.&lt;/p>
&lt;p>If the mainboard&amp;rsquo;s battery responsible for storing time dies, it can become an even more annoying problem, because Windows will always start with an ever-growing time skew, which can eventually result in web browsing become a problem due to Windows considering websites&amp;rsquo; SSL certificates &lt;em>not yet valid&lt;/em> - effectively rendering browsing the majority of web pages impossible!&lt;/p>
&lt;p>This can be worked around by starting Windows&amp;rsquo; time sync service automatically at startup. Below you&amp;rsquo;ll find instructions on doing this with the graphical &lt;em>Services&lt;/em> console and PowerShell.&lt;/p>
&lt;h1 id="services-console">Services console&lt;/h1>
&lt;ol>
&lt;li>Press &lt;code>Windows Key&lt;/code> + &lt;code>r&lt;/code> at the same time to open the &lt;strong>Run&lt;/strong> dialogue&lt;/li>
&lt;li>Type &lt;code>services.msc&lt;/code> and hit &lt;strong>Run&lt;/strong> - the &lt;strong>Services&lt;/strong> window opens &lt;img src="https://valh.io/img/posts/run_services-msc.webp" alt="Run dialog">&lt;/li>
&lt;li>In the list, scroll to &lt;strong>Windows Time&lt;/strong> (in german: &lt;strong>Windows-Zeitgeber&lt;/strong>) and right-click on it, click &lt;strong>Properties&lt;/strong> in the context menu&lt;/li>
&lt;li>In the &lt;strong>Properties&lt;/strong> window change &lt;strong>Startup type&lt;/strong> to &lt;em>Automatic&lt;/em>, click &lt;strong>Start&lt;/strong> and click &lt;strong>OK&lt;/strong> to save &lt;img src="https://valh.io/img/posts/windows_time_service_properties.webp" alt="Windows time service properties window">&lt;/li>
&lt;/ol>
&lt;h1 id="powershell">PowerShell&lt;/h1>
&lt;ol>
&lt;li>Start PowerShell as admin&lt;/li>
&lt;li>Run the following command:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">Set-Service&lt;/span> &lt;span class="n">-Name&lt;/span> &lt;span class="n">W32Time&lt;/span> &lt;span class="n">-Status&lt;/span> &lt;span class="n">running&lt;/span> &lt;span class="n">-StartupType&lt;/span> &lt;span class="n">automatic&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If PowerShell complains about not finding a service with the specified name, you can run the following command to get a list of all available services - Microsoft might have changed the time service&amp;rsquo;s name.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">Get-Service&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Let HomeAssistant notify you of updates</title><link>https://valh.io/p/let-homeassistant-notify-you-of-updates/</link><pubDate>Fri, 11 Jun 2021 19:21:36 +0000</pubDate><guid>https://valh.io/p/let-homeassistant-notify-you-of-updates/</guid><description>
&lt;p>&lt;a href="https://www.home-assistant.io/">HomeAssistant&lt;/a> releases new updates very regularly. Each month there is a new release which usually receives several patch releases as well. If you want to keep up with updates or even update automatically, it&amp;rsquo;s nice to get notified upon the release of an update.&lt;/p>
&lt;h1 id="prerequisites">Prerequisites&lt;/h1>
&lt;p>HomeAssistant has a built-in updater sensor which automatically checks for the updates and changes state, if it finds one. This can be used as &lt;code>trigger&lt;/code> in an automation. The automation&amp;rsquo;s &lt;code>action&lt;/code> can do all kinds of things; e.g. send a notification to a phone, which has the HomeAssistant app installed.&lt;/p>
&lt;p>Having installed the HomeAssistant app on your phone, you can send notifications to it via HomeAssistant - including from an automation. The &lt;a href="https://www.home-assistant.io/integrations/mobile_app/">Mobile app integration&lt;/a> must be enabled for this to work - it is by default.&lt;/p>
&lt;p>If you want to be extra sure that the notification always arrives immediately, I&amp;rsquo;d suggest deactivating any battery optimization for the HomeAssistant app - at least on the recent versions of Android that goes for pretty much any app that sends notifications which you want to be sure to get without waking your phone from doze.&lt;/p>
&lt;p>You can do it in the system settings; depending on the Android variant the path in the settings might vary but usually it&amp;rsquo;s here: &lt;em>Apps&lt;/em> -&amp;gt; &lt;em>See all apps&lt;/em> -&amp;gt; &lt;em>HomeAssistant&lt;/em> -&amp;gt; &lt;em>Advanced&lt;/em> -&amp;gt; &lt;em>Battery optimization&lt;/em> -&amp;gt; &lt;em>Don&amp;rsquo;t optimize&lt;/em>.&lt;/p>
&lt;h1 id="automation">Automation&lt;/h1>
&lt;p>Using the updater sensor and app notification functionality, one can built an automation which sends a notification upon state change of &lt;code>binary_sensor.updater&lt;/code>. You can find my automation snippet &lt;a href="https://github.com/va1entin/homeassistant-config/blob/b69451aba22034d2838bb9a5ae0c13e7bdfbd53e/automation/version.yaml">on GitHub&lt;/a>.&lt;/p>
&lt;p>The automation uses the most recent version&amp;rsquo;s number in it&amp;rsquo;s output text - this is accomplished by referencing an attribute of &lt;code>binary_sensor.updater&lt;/code> called &lt;code>newest_version&lt;/code>. You can change the notification&amp;rsquo;s content as you please by modifying the attributes below &lt;code>action&lt;/code> -&amp;gt; &lt;code>data&lt;/code> in the snippet.&lt;/p>
&lt;p>Unless you have the exact same phone model as me, you &lt;strong>must&lt;/strong> change the &lt;code>service&lt;/code> in the automation&amp;rsquo;s &lt;code>action&lt;/code>. In my case it&amp;rsquo;s set to &lt;code>notify.mobile_app_oneplus_nord_n105g&lt;/code> - you must change it to your phone after having installed the HomeAssistant app and registered it with your instance.&lt;/p>
&lt;p>The ID of your phone inside HomeAssistant can be found by opening the list of integrations &lt;code>&amp;lt;your homeassistant instance ip or hostname&amp;gt;/config/integrations&lt;/code>, finding your phone there and clicking on the blue link &lt;code>... entities&lt;/code>. In the entity list, you&amp;rsquo;ll find a column called &lt;code>Entity ID&lt;/code> and copy the phone&amp;rsquo;s name from there, replacing anything before the dot with &lt;code>notify&lt;/code> as seen in the automation snippet.&lt;/p>
&lt;p>The automation can be tested by setting the state of &lt;code>binary_sensor.updater&lt;/code> from &lt;code>off&lt;/code> to &lt;code>on&lt;/code> in the HomeAssistant Developer Tools: &lt;code>&amp;lt;your homeassistant instance ip or hostname&amp;gt;/developer-tools/state&lt;/code>&lt;/p>
&lt;p>If the state was already &lt;code>on&lt;/code>, you need to set it to &lt;code>off&lt;/code> first.&lt;/p>
&lt;p>The state change to &lt;code>on&lt;/code> should trigger the automation and produce a notification like so:&lt;/p>
&lt;p>&lt;img src="https://valh.io/img/posts/homeassistant_version_notification.webp" alt="HomeAssistant version notification on Android">&lt;/p>
&lt;h1 id="activation-switch">Activation switch&lt;/h1>
&lt;p>Usually I also add a switch (&amp;ldquo;boolean input&amp;rdquo;) to my automations so I can quickly toggle functionalities from the HomeAssistant dashboard separate from the Automations config section. The code snippet for that can be found &lt;a href="https://github.com/va1entin/homeassistant-config/blob/b69451aba22034d2838bb9a5ae0c13e7bdfbd53e/input_boolean/version.yaml">on GitHub&lt;/a> as well.&lt;/p>
&lt;p>It&amp;rsquo;s being referenced in the automation snippet, so you need to either add this switch as well as the automation or remove the relevant lines, if you don&amp;rsquo;t want the switch.&lt;/p>
&lt;p>Having added it to a card called &amp;ldquo;Notifications&amp;rdquo;, it looks like this in the HomeAssistant dashboard:&lt;/p>
&lt;p>&lt;img src="https://valh.io/img/posts/homeassistant_update_notifications_switch.webp" alt="HomeAssistant version notification switch">&lt;/p></description></item><item><title>Python cheat sheet for InfluxDB2 (influxdb_client)</title><link>https://valh.io/p/python-cheat-sheet-for-influxdb2-influxdb_client/</link><pubDate>Tue, 02 Mar 2021 15:53:11 +0000</pubDate><guid>https://valh.io/p/python-cheat-sheet-for-influxdb2-influxdb_client/</guid><description>
&lt;h1 id="setup-influxdb-test-instance-with-docker">Setup InfluxDB test instance with Docker&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker run -d -p 8086:8086 --name influxdb influxdb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This command pulls the latest InfluxDB image from Docker Hub, runs it with the name &lt;code>influxdb&lt;/code> and makes the default port &lt;code>8086&lt;/code> available on &lt;code>localhost&lt;/code>.
Once the container is up and running, we need to setup InfluxDB before we can use it.&lt;/p>
&lt;p>Open a shell in the InfluxDB container:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it influxdb bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Start the interactive setup wizard by running &lt;code>influx setup&lt;/code>.
The wizard will ask you to provide initial admin credentials, your first organization, your first bucket and a retention period for it.&lt;/p>
&lt;p>I have created a user &lt;code>val&lt;/code> with a password (invisible in the wizard), an organization called &lt;code>my_org&lt;/code> and a bucket &lt;code>my_bucket&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>root@d8818fce8c18:/# influx setup
Welcome to InfluxDB 2.0!
Please type your primary username: val
Please type your password:
Please type your password again:
Please type your primary organization name: my_org
Please type your primary bucket name: my_bucket
Please type your retention period in hours.
Or press ENTER for infinite.:
&lt;/code>&lt;/pre>&lt;p>Lastly, the wizard will ask you to confirm your inputs:&lt;/p>
&lt;pre tabindex="0">&lt;code>You have entered:
Username: val
Organization: my_org
Bucket: my_bucket
Retention Period: infinite
Confirm? (y/n): y
Config default has been stored in /root/.influxdbv2/configs.
User Organization Bucket
val my_org my_bucket
&lt;/code>&lt;/pre>&lt;p>One advantage of performing the setup using the CLI is that it writes your initial admin user&amp;rsquo;s credentials to a config file, allowing you to manage your InfluxDB instance using the &lt;code>influx&lt;/code> CLI directly with admin privileges.&lt;/p>
&lt;p>We&amp;rsquo;ll use this to get our initial admin user&amp;rsquo;s token, which we&amp;rsquo;ll use later to set up the connection to InfluxDB in Python.&lt;/p>
&lt;p>&lt;code>influx auth list&lt;/code> gives us a list of existing users and tokens. For the sake of readability I&amp;rsquo;m using &lt;code>awk&lt;/code> to limit output to just the token.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@d8818fce8c18:/# influx auth list &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;FNR&amp;gt;1 {print $4}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">_U13AGG9YWojXjuh2OAUKqtsA20Fual8Vt_aVTvdJ1eWUJu0pH85ppkCEM3lL5hEpNS_8vPRh7nik8QkEvfZFA&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Save your token somewhere to have it at hand for the &lt;a href="#connection-setup">Connection setup&lt;/a> step.&lt;/p>
&lt;p>Now, we can exit the container shell:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@d8818fce8c18:/# &lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="install-influxdb_client-with-pip">Install influxdb_client with pip&lt;/h1>
&lt;p>Depending on your setup and linux distro you might want to do this with the distro&amp;rsquo;s package manager.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pip3 install influxdb-client &lt;span class="c1"># NOT &amp;#39;influx-client&amp;#39; or &amp;#39;influxdb&amp;#39;!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="connection-setup-required-for-all-steps-below">Connection setup (required for all steps below)&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">influxdb_client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">my_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">InfluxDBClient&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">my_url&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">token&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">my_token&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">org&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;my_org&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>To connect to the docker test instance, use the token obtained after the &lt;a href="#setup-influxdb-test-instance-with-docker">InfluxDB setup&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">influxdb_client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">my_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">InfluxDBClient&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;http://localhost:8086&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">token&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;_U13AGG9YWojXjuh2OAUKqtsA20Fual8Vt_aVTvdJ1eWUJu0pH85ppkCEM3lL5hEpNS_8vPRh7nik8QkEvfZFA==&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">org&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;my_org&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="test-connection">Test connection&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">my_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ready&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;started&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2021&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">23&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">29&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">916723&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">tzinfo&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">tzlocal&lt;/span>&lt;span class="p">()),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;status&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ready&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;up&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;47m11.068245257s&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="query-data">Query data&lt;/h1>
&lt;br>
&lt;h2 id="get-query-api">Get query api&lt;/h2>
&lt;p>Firstly, obtain a query API instance:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_query_api&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">my_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query_api&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="create-a-query">Create a query&lt;/h2>
&lt;p>Check out the official &lt;a href="https://docs.influxdata.com/influxdb/v2.0/query-data/get-started/">documentation&lt;/a> for the Flux query language to learn how to build queries.&lt;/p>
&lt;p>This is a very basic example getting all data points of the measurement &lt;code>my_measurement&lt;/code> from the last 100 minutes in &lt;code>my_bucket&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">query&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;from(bucket:&amp;#34;my_bucket&amp;#34;)&lt;/span>&lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="s1">|&amp;gt; range(start: -100m)&lt;/span>&lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="s1">|&amp;gt; filter(fn:(r) =&amp;gt; r._measurement == &amp;#34;my_measurement&amp;#34;)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="run-a-query">Run a query&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_query_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;my_org&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">query&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>See the official &lt;a href="https://docs.influxdata.com/influxdb/cloud/tools/client-libraries/python/#query-data-from-influxdb-with-python">InfluxDB documentation&lt;/a> for ways to use the result data including an example script.&lt;/p>
&lt;br>
&lt;h2 id="get-dict-from-data-point">Get dict from data point&lt;/h2>
&lt;p>For this example I have created a data point as shown &lt;a href="#write-a-data-point">here&lt;/a>.&lt;/p>
&lt;p>Assuming you have a &lt;code>influxdb_client.Point&lt;/code> object, a dict representation of it&amp;rsquo;s contents can be obtained like so:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">point&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="vm">__dict__&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The output will look something like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;_tags&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;my_tag&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_value&amp;#39;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="s1">&amp;#39;_fields&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;my_first_field&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my second field value&amp;#39;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="s1">&amp;#39;_name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_measurement&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;_time&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2021&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">13&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">692337&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;_write_precision&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ms&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="write-data">Write data&lt;/h1>
&lt;br>
&lt;h2 id="get-write-api">Get write api&lt;/h2>
&lt;p>You need to specify which &lt;code>write option&lt;/code> the client shall use when creating the instance.
At the time of writing this post the possible write options are: synchronous, asynchronous, batching&lt;/p>
&lt;p>There are shortcuts for &lt;code>synchronous&lt;/code> and &lt;code>asynchronous&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SYNCHRONOUS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ASYNCHRONOUS&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>batching&lt;/code> is accessible by creating an &lt;code>WriteOptions&lt;/code> instance and passing it the &lt;code>WriteType&lt;/code> of &lt;code>batching&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">WriteOptions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">WriteType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">batching&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Using the &lt;code>write option&lt;/code>, that you&amp;rsquo;ve decided for, you can get a &lt;code>write api&lt;/code> instance:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_write_api&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">my_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_api&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">write_options&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SYNCHRONOUS&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="write-a-data-point">Write a data point&lt;/h2>
&lt;p>A data point is created from an &lt;code>influxdb_client.Point&lt;/code> object. To put our data in, we can either:&lt;/p>
&lt;ul>
&lt;li>use various functions of the Point object itself&lt;/li>
&lt;li>pass it a dict&lt;/li>
&lt;/ul>
&lt;p>I prefer using a dict, because I think it&amp;rsquo;s much more readable and easy to understand. This might be especially useful for people who know Python but are not perfectly familiar with how &lt;code>influxdb_client.Point&lt;/code> objects work in detail.&lt;/p>
&lt;p>&lt;code>my_time&lt;/code> must be a timestamp, that InfluxDB understands.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">point&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Point&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_dict&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;measurement&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_measurement&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;tags&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;my_tag&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_value&amp;#39;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;fields&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;my_first_field&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my first field value&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;my_first_field&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my second field value&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;time&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_time&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">WritePrecision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;my_bucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;my_org&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For example, you can use the &lt;code>datetime&lt;/code> module:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">point&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Point&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_dict&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;measurement&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_measurement&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;tags&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;my_tag&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my_value&amp;#39;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;fields&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;my_first_field&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my first field value&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;my_first_field&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;my second field value&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;time&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">WritePrecision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_write_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;my_bucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;my_org&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="buckets">Buckets&lt;/h1>
&lt;p>Firstly, obtain a buckets API instance:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_buckets_api&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">my_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">buckets_api&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="get-all-buckets-in-current-org">Get all buckets in current org&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">bucket_objects&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_buckets_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_buckets&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="get-all-bucket-names-in-current-org">Get all bucket names in current org&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">bucket_objects&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_buckets_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_buckets&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bucket_names&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">bucket&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">bucket&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">bucket_objects&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">buckets&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="get-bucket-object-by-bucket-name">Get bucket object by bucket name&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">my_bucket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_buckets_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_bucket_by_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;my_bucket&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="create-bucket">Create bucket&lt;/h2>
&lt;p>See &lt;a href="#get-org-id">this section&lt;/a> for getting &lt;code>my_org_id&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">new_bucket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">domain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bucket&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Bucket&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;my_new_bucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">retention_rules&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">org_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">my_org_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_buckets_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_bucket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_bucket&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="delete-bucket">Delete bucket&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">bucket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_buckets_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_bucket_by_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;my_bucket&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_buckets_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">delete_bucket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bucket&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;hr>
&lt;br>
&lt;h1 id="organizations">Organizations&lt;/h1>
&lt;p>Firstly, obtain a organizations API instance:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_org_api&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">OrganizationsApi&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_client&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="get-all-organizations">Get all organizations&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">orgs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">influxdb_org_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_organizations&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="get-organization-id">Get organization id&lt;/h2>
&lt;p>Look for your organization in the list of all organizations &lt;code>orgs&lt;/code>, which you obtained in the previous step.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">org&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">orgs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">org&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;my_org&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">my_org_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">org&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_org_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="create-organization">Create organization&lt;/h2>
&lt;p>&lt;code>my_new_org&lt;/code> will be the new organization&amp;rsquo;s name.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_org_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_organization&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;my_new_org&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br>
&lt;h2 id="delete-organization">Delete organization&lt;/h2>
&lt;p>To delete an organization, you need it&amp;rsquo;s ID. See &lt;a href="#get-organization-id">Get organization id&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">influxdb_org_api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">delete_organization&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_org_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;br></description></item><item><title>Talk: How SUSE migrated 200k user accounts to UCS</title><link>https://valh.io/p/talk-how-suse-migrated-200k-user-accounts-to-ucs/</link><pubDate>Tue, 16 Feb 2021 17:50:56 +0000</pubDate><guid>https://valh.io/p/talk-how-suse-migrated-200k-user-accounts-to-ucs/</guid><description>
&lt;p>During my time as a Consultant &amp;amp; Engineer with &lt;a href="https://univention.com">Univention&lt;/a>, I supported Daniel Schmidt and his colleagues at &lt;a href="https://suse.com">SUSE&lt;/a> in their migration of 200k user accounts from a legacy identity management to &lt;a href="https://univention.com">Univention Corporate Server&lt;/a> (UCS).&lt;/p>
&lt;p>It was a live migration over the course of weekend and I provided technical consulting as well as live patches and enhancements to UCS for issues and areas of improvements which were found during the migration.&lt;/p>
&lt;p>During this year&amp;rsquo;s virtual Univention Summit, Daniel presented that story in a &lt;a href="https://www.youtube.com/watch?v=q-NY9JCz6VA">talk&lt;/a> which I&amp;rsquo;d like to share with you. The talk is in German and - at this point - has no English subtitles.&lt;/p>
&lt;p>Thanks a lot for the kudos @18:11 to you, Daniel! :)&lt;/p>
&lt;p>I&amp;rsquo;ve had a great time working with you and your team. Best wishes from Bremen!&lt;/p>
&lt;iframe width="100%" height="315" src="https://www.youtube.com/embed/q-NY9JCz6VA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>&lt;/iframe></description></item><item><title>Python script for Cloudflare DNS record updates (DynDNS)</title><link>https://valh.io/p/python-script-for-cloudflare-dns-record-updates-dyndns/</link><pubDate>Sat, 06 Feb 2021 15:53:11 +0000</pubDate><guid>https://valh.io/p/python-script-for-cloudflare-dns-record-updates-dyndns/</guid><description>
&lt;p>&lt;strong>Note:&lt;/strong> This is an update to a post from 2019 and features a rewrite in Python with various new features including IPv6 support, logging, argument parser, &amp;hellip;&lt;/p>
&lt;h1 id="why">Why&lt;/h1>
&lt;p>I&amp;rsquo;m using Cloudflare as CDN and DNS provider as well as domain registrar. For a system with an external IPv4 address that changes daily I needed a way to dynamically update a DNS record at Cloudflare with the system&amp;rsquo;s current external IP address.&lt;/p>
&lt;p>There are numerous ways to do DynDNS but I wanted to get into Cloudflare&amp;rsquo;s API anyway and it turns out that this is, at least in my opinion, much easier to set up than some generic DynDNS package.&lt;/p>
&lt;h1 id="how">How&lt;/h1>
&lt;h2 id="getting-the-script">Getting the script&lt;/h2>
&lt;p>I&amp;rsquo;ve written a Python script, based on a bash script by &lt;a href="https://gist.github.com/benkulbertis/fff10759c2391b6618dd">benkulbertis&lt;/a>.&lt;/p>
&lt;p>The Python script does &lt;em>not&lt;/em> require a general API token. So you can set up API tokens specifically authorized for what the script needs to do.&lt;/p>
&lt;p>You can get the script &lt;a href="https://github.com/va1entin/tools/blob/master/cloudflare_update_record/cloudflare_update_record.py">here&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/va1entin/tools/master/cloudflare_update_record/cloudflare_update_record.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="setting-up-api-tokens">Setting up API tokens&lt;/h2>
&lt;p>The script needs two tokens:&lt;/p>
&lt;ul>
&lt;li>one to read DNS records and settings&lt;/li>
&lt;li>one to actually edit a DNS zone&lt;/li>
&lt;/ul>
&lt;p>To set the tokens up, log in to your Cloudflare account and go to &lt;a href="https://dash.cloudflare.com/profile/api-tokens">this page&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Note&lt;/strong>, that you can also limit the tokens to a specific domain! This is of course important to know if you have multiple domains in your Cloudflare account and the script shall only read/edit the settings of one of these.&lt;/p>
&lt;h3 id="edit-token">Edit token&lt;/h3>
&lt;p>On the &lt;a href="https://dash.cloudflare.com/profile/api-tokens">API token page&lt;/a>, click &lt;strong>Create Token&lt;/strong> and use the template &lt;strong>Edit zone DNS&lt;/strong>.&lt;/p>
&lt;p>Alternatively, click &lt;strong>Get started&lt;/strong> next to &lt;strong>Create Custom Token&lt;/strong> and configure the token as follows:&lt;/p>
&lt;table class="table table-striped table-bordered">
&lt;thead>
&lt;tr>
&lt;th>Type&lt;/th>
&lt;th>Resource&lt;/th>
&lt;th>Permission&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Zone&lt;/td>
&lt;td>DNS&lt;/td>
&lt;td>Edit&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Click &lt;a href="https://valh.io/img/posts/cloudflare_edit_token.webp">here&lt;/a> for a screenshot.&lt;/p>
&lt;h3 id="read-token">Read token&lt;/h3>
&lt;p>On the &lt;a href="https://dash.cloudflare.com/profile/api-tokens">API token page&lt;/a>, click &lt;strong>Create Token&lt;/strong> and click &lt;strong>Get started&lt;/strong> next to &lt;strong>Create Custom Token&lt;/strong>.&lt;/p>
&lt;table class="table table-striped table-bordered">
&lt;thead>
&lt;tr>
&lt;th>Type&lt;/th>
&lt;th>Resource&lt;/th>
&lt;th>Permission&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Zone&lt;/td>
&lt;td>DNS&lt;/td>
&lt;td>Read&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Click &lt;a href="https://valh.io/img/posts/cloudflare_read_token.webp">here&lt;/a> for a screenshot.&lt;/p>
&lt;h2 id="create-config-file">Create config file&lt;/h2>
&lt;p>The script uses a YAML-format config file and assumes it at &lt;code>./cloudflare_update_record_config.yaml&lt;/code>. You can give a different path using the &lt;code>-c | --config&lt;/code> parameter.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">read_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;YOUR READ TOKEN&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">edit_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;YOUR EDIT TOKEN&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zone_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;YOUR ZONE NAME&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">record_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;YOUR RECORD NAME&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So if I wanted to change a DNS record called &lt;em>hello.example.com&lt;/em> using a read token &lt;em>foo&lt;/em> and an edit token &lt;em>bar&lt;/em>, the config would look like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">read_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;foo&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">edit_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;bar&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zone_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;example.com&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">record_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>To change the root record of your domain - &lt;em>example.com&lt;/em> itself - use @ as record_name, just like in the Cloudflare dashboard:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">read_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;foo&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">edit_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;bar&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zone_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;example.com&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">record_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;@&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="run-script">Run script&lt;/h2>
&lt;p>Lastly run the script with your desired parameters. I recommend reading the brief usage info at least once:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">./cloudflare_update_record.py -h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="logging">Logging&lt;/h3>
&lt;p>The scripts logs to &lt;code>cloudflare_update_record.log&lt;/code> with log level &lt;code>info&lt;/code> by default. You can change the log file and log level, see &lt;code>-h&lt;/code>.&lt;/p>
&lt;h3 id="ip-provider">IP provider&lt;/h3>
&lt;p>It gets the external IP address from a &lt;em>provider&lt;/em>, by default: &lt;a href="https://icanhazip.com">icanhazip.com&lt;/a>&lt;/p>
&lt;p>You can specify a different provider, see &lt;code>-h&lt;/code>.
The provider must return &lt;strong>just the IP address as plain text&lt;/strong> on a &lt;code>HTTP GET&lt;/code> request - no additional HTML or anything else. Assuming an external IPv4 address &lt;code>1.1.1.1&lt;/code>, it should look like this, when tested with curl:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># curl https://ipv4.icanhazip.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.1.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="update-a-dns-a-ipv4-record">Update a DNS A (IPv4) record&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cloudflare_update_record.py -4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="update-a-dns-aaaa-ipv6-record">Update a DNS AAAA (IPv6) record&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cloudflare_update_record.py -6
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Check the log for a message &lt;code>INFO: DNS A record update succeeded, IP changed to: &amp;lt;YOUR IP ADDRESS&amp;gt;&lt;/code>
and remember that it might take up to 24 hours for your DNS update to be propagated around the world.&lt;/p></description></item><item><title>Simple CLI audio metadata editor: tag_dat.py</title><link>https://valh.io/p/simple-cli-audio-metadata-editor-tag_dat.py/</link><pubDate>Sat, 05 Dec 2020 17:11:08 +0000</pubDate><guid>https://valh.io/p/simple-cli-audio-metadata-editor-tag_dat.py/</guid><description>
&lt;p>Audio metadata is often not particularly easy to manage in a simple and quick manner. There&amp;rsquo;s lots of tools providing this feature but many of them have a ton of other additional functionality or are full-on music library managers. I wanted a very simple command-line tool to quickly change the title, artist and album tags of audio metadata - the result is &amp;ldquo;tag_dat.py&amp;rdquo; and available in my &lt;a href="https://github.com/va1entin/tools/tree/master/tag_dat">tools repository&lt;/a>.&lt;/p>
&lt;p>tag_dat.py iterates over a file or all files in a given path (default: current path), sets the filename (without file ending) as &lt;em>title&lt;/em> and given arguments &lt;em>album&lt;/em> and &lt;em>artist&lt;/em> as audio tags. The script uses the amazing &amp;ldquo;mutagen&amp;rdquo; library under the hood.&lt;/p>
&lt;p>Here are a few usage examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set MyArtist and MyAlbum for all files in current path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./tag_dat.py -ar MyArtist -al MyAlbum
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set MyArtist and MyAlbum for my_file.mp3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./tag_dat.py -ar MyArtist -al MyAlbum -f my_file.mp3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set MyArtist and MyAlbum for all files in path music/MyAlbum/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./tag_dat.py -ar MyArtist -al MyAlbum -p music/MyAlbum/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Get Ledger Live working on NixOS</title><link>https://valh.io/p/get-ledger-live-working-on-nixos/</link><pubDate>Thu, 14 Nov 2019 18:21:22 +0000</pubDate><guid>https://valh.io/p/get-ledger-live-working-on-nixos/</guid><description>
&lt;p>The &lt;a href="https://ledger.com">Ledger Nano series&lt;/a> are hardware wallets for crypto currencies. They&amp;rsquo;re managed through an application called &lt;a href="https://shop.ledger.com/pages/ledger-live">Ledger Live&lt;/a>. Ledger Live runs on linux but might - depending on your distro - require some adjustments in order to correctly identify the device via USB.
I couldn&amp;rsquo;t test whether this config works with all Ledger devices so far. Feel free to drop me a &lt;a href="https://twitter.com/valhei">tweet&lt;/a> if you have anything to add to this post and I&amp;rsquo;ll gladly update it.&lt;/p>
&lt;p>On NixOS I needed the following additional config snippets to use my Ledger fully:&lt;/p>
&lt;h1 id="define-a-group-called-plugdev">Define a group called &amp;ldquo;plugdev&amp;rdquo;&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nix" data-lang="nix">&lt;span class="line">&lt;span class="cl">&lt;span class="n">groups&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plugdev&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="p">{};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="add-users-to-plugdev">Add user(s) to &amp;ldquo;plugdev&amp;rdquo;&lt;/h1>
&lt;p>Note that you your user will most likely already be in various other groups such as &lt;em>networkmanager&lt;/em> or &lt;em>wheel&lt;/em>. Just append plugdev to the &lt;em>extraGroups&lt;/em> list.
Replace &lt;em>myUser&lt;/em> with your user name.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nix" data-lang="nix">&lt;span class="line">&lt;span class="cl">&lt;span class="n">users&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">users&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">myUser&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">extraGroups&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="s2">&amp;#34;plugdev&amp;#34;&lt;/span> &lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="add-extra-rules-for-udev">Add extra rules for udev&lt;/h1>
&lt;p>Ledger provides udev rules which need to be added kind of hidden (linux -&amp;gt; Troubleshooting -&amp;gt; Option 3) &lt;a href="https://support.ledger.com/hc/en-us/articles/115005165269-Fix-connection-issues">on their website&lt;/a>. You can check out my NixOS config containing these rules &lt;a href="https://github.com/va1entin/nixos-config/blob/master/ledger.nix">on GitHub&lt;/a>. I&amp;rsquo;ve decided to not statically post them here and instead refer to the GitHub mirror of my NixOS config, because they might change with Ledger firmware updates. You must change &amp;ldquo;val&amp;rdquo; to your username.&lt;/p>
&lt;p>I&amp;rsquo;m not entirely sure whether it&amp;rsquo;s really necessary but I reload the rules after I&amp;rsquo;ve changed them and rebuilt NixOS just to make sure they are being applied:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">udevadm trigger
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udevadm control --reload-rules
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Providing access to thousands of external storages using Nextcloud</title><link>https://valh.io/p/providing-access-to-thousands-of-external-storages-using-nextcloud/</link><pubDate>Mon, 28 Oct 2019 18:41:14 +0000</pubDate><guid>https://valh.io/p/providing-access-to-thousands-of-external-storages-using-nextcloud/</guid><description>
&lt;p>A few weeks ago I&amp;rsquo;ve held a talk involving a solution I&amp;rsquo;ve built @&lt;a href="https://univention.com">univention&lt;/a> for a customer using Univention Corporate Server and Nextcloud at this year&amp;rsquo;s Nextcloud conference.&lt;/p>
&lt;p>The talk is available &lt;a href="https://www.youtube.com/watch?v=ZjLiSL_XYvs&amp;amp;t=1766">on YouTube&lt;/a>.&lt;/p>
&lt;p>The documentation for the cool solution I&amp;rsquo;m referring to in the talk can be found in the &lt;a href="https://help.univention.com/t/cool-solution-mount-samba-shares-in-nextcloud/">Univention Knowledge Base&lt;/a>.&lt;/p>
&lt;p>Thanks a lot to the folks at Nextcloud and especially &lt;a href="https://twitter.com/nlapalice">Nina&lt;/a> and &lt;a href="https://twitter.com/jospoortvliet">Jos&lt;/a> for the invitation and great discussions!&lt;/p>
&lt;iframe width="100%" height="315" src="https://www.youtube.com/embed/ZjLiSL_XYvs?start=1766" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>&lt;/iframe></description></item><item><title>Nextcloud for UCS now comes with SSO out of the box</title><link>https://valh.io/p/nextcloud-for-ucs-now-comes-with-sso-out-of-the-box/</link><pubDate>Sun, 29 Sep 2019 13:42:20 +0000</pubDate><guid>https://valh.io/p/nextcloud-for-ucs-now-comes-with-sso-out-of-the-box/</guid><description>
&lt;p>A few weeks ago I&amp;rsquo;ve held a talk involving a solution I built @&lt;a href="https://univention.com">univention&lt;/a> for a customer using Univention Corporate Server and Nextcloud at this year&amp;rsquo;s Nextcloud conference. The video of that will probably be available in the next few weeks and I&amp;rsquo;ll share it here once it&amp;rsquo;s available.&lt;/p>
&lt;p>UPDATE: See &lt;a href="https://valh.io/blog/Nextcloud-conference-2019.html">here&lt;/a> for the video of the talk.&lt;/p>
&lt;p>Another interesting thing regarding Nextcloud and UCS happened in the meantime though: The &lt;a href="https://www.univention.com/products/univention-app-center/app-catalog/nextcloud/">Nextcloud app for UCS&lt;/a> now comes with pre-configured Single Sign-On (SSO) using SAML. This is very cool because lots of our customers want to make use of SSO but the configuration is not always trivial. Using a &lt;a href="https://www.univention.com/blog-en/2019/02/how-to-single-sign-on-for-nextcloud/">blog post&lt;/a> I wrote for the Univention blog in February, Nextcloud, namely Arthur Schiwon aka @&lt;a href="https://github.com/blizzz">blizzz&lt;/a>, were able to &lt;a href="https://github.com/nextcloud/univention-app/issues/91">bake the configuration&lt;/a> into the app and thus make it really easy for people to get started with UCS, Nextcloud and SSO! If you&amp;rsquo;d like to find out more about SSO with SAML, feel free to check out my &lt;a href="https://www.univention.com/blog-en/2019/06/brief-introduction-saml-a-secure-comfortable-web-access/">blog post&lt;/a> about it.&lt;/p></description></item><item><title>Simple file encryption module for Python projects</title><link>https://valh.io/p/simple-file-encryption-module-for-python-projects/</link><pubDate>Sat, 08 Sep 2018 11:40:23 +0000</pubDate><guid>https://valh.io/p/simple-file-encryption-module-for-python-projects/</guid><description>
&lt;h1 id="tldr">tl;dr&lt;/h1>
&lt;p>Plasm focuses on a very specific use case: encrypting and decrypting files using public key encryption. If plasm doesn&amp;rsquo;t fit the scope of what you want to do, feel free to have a look at &lt;a href="https://pynacl.readthedocs.io">pynacl&amp;rsquo;s documentation&lt;/a> and use it directly.&lt;/p>
&lt;h1 id="why">Why&lt;/h1>
&lt;p>I have experimented a lot with camera software for the Raspberry Pi. One project that particularly stuck with me is &lt;a href="https://github.com/ccrisan/motioneye">motionEye&lt;/a>, a web frontend for the motion daemon, which allows you to easily set up an open source motion triggered camera for about 50€.&lt;/p>
&lt;p>MotionEye also offers a cloud upload functionality, which I like a lot. Unfortunately it doesn&amp;rsquo;t allow the user to encrypt their media files before uploading them. Since I wanted to use Google Drive as my data grave but at the same time not upload unencrypted media files into the cloud, I decided to build a simple python module to easily hack file encryption into motionEye.&lt;/p>
&lt;h1 id="what-it-is">What it is&lt;/h1>
&lt;p>The result of this is &lt;a href="https://github.com/va1entin/plasm">plasm&lt;/a>, which stands for &lt;code>PynacL AbStraction Module&lt;/code>. Plasm is based on &lt;a href="https://github.com/pyca/pynacl">pynacl&lt;/a>, which in turn binds to &lt;a href="https://libsodium.org">libsodium&lt;/a>.&lt;/p>
&lt;p>Plasm uses public key encryption and is supposed to make the &lt;strong>creation of public key pairs&lt;/strong> as well as &lt;strong>encryption and decryption of files&lt;/strong> very simple.&lt;/p>
&lt;p>One key requirement for me was that plasm had to be able to encrypt using only a public key. The private key, which is required to decrypt, shouldn&amp;rsquo;t be required so that I could store it in a safe place on another device. To accomplish this, I chose to use the &lt;code>sealedBox&lt;/code> construct, because it only requires a public key. The main difference of the &lt;code>sealedBox&lt;/code> compared to another construct simply called &lt;code>Box&lt;/code> is that it doesn&amp;rsquo;t offer cryptographic proof of the sender’s authorship, which is out of scope for plasm anyway.&lt;/p>
&lt;p>Additionally, I wanted to protect the private key by encrypting it as well using secret key encryption. That&amp;rsquo;s why plasm requires a password for creating a key pair and decrypting files. The password is used to encrypt and decrypt the key so that an attacker needs both the private key file &lt;strong>and&lt;/strong> the password to be able to decrypt files.&lt;/p>
&lt;h1 id="installation-and-how-it-works">Installation and how it works&lt;/h1>
&lt;p>Please have a look at the &lt;a href="https://github.com/va1entin/plasm/blob/master/README.md">README&lt;/a> to find out how to use plasm.&lt;/p>
&lt;p>Plasm is currently not available via PyPi, but you can install it directly from Github as follows:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wget https://github.com/va1entin/plasm/archive/refs/heads/master.zip -O plasm-master.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install plasm-master.zip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="integration-with-motioneye">Integration with motionEye&lt;/h1>
&lt;p>The integration with motionEye currently requires a little patch to be applied to it&amp;rsquo;s &lt;code>uploadservices.py&lt;/code>, which is located at &lt;code>/usr/local/lib/python2.7/dist-packages/motioneye/uploadservices.py&lt;/code> on Raspbian. You can download it directly &lt;a href="https://github.com/va1entin/plasm/raw/master/integrations/motioneye-uploadservices.patch">here&lt;/a> (right click -&amp;gt; save as).&lt;/p>
&lt;p>Make sure to change the path to your public key accordingly and add &lt;code>remove_input_file=True&lt;/code> as shown in the &lt;a href="https://github.com/va1entin/plasm/blob/master/README.md">README&lt;/a>, if you want plasm to remove the unencrypted input file once encryption is finished.&lt;/p>
&lt;p>Plasm also logs what it&amp;rsquo;s doing using the logging module by default. Most logging happens at debug log level currently. Have a look at the &lt;a href="https://github.com/ccrisan/motioneye/wiki/Configuration-File">motionEye wiki&lt;/a> to find out how to enable debug logging.&lt;/p>
&lt;h1 id="conclusion">Conclusion&lt;/h1>
&lt;p>Plasm is licensed under the Apache 2.0 License. Feel free to report issues or create merge requests at &lt;a href="https://github.com/va1entin/plasm">Github&lt;/a>. Please note that I don&amp;rsquo;t plan to extend plasm&amp;rsquo;s scope on other use cases at the moment to keep it as simple as possible. If plasm doesn&amp;rsquo;t fit the scope of what you want to do, feel free to have a look at &lt;a href="https://pynacl.readthedocs.io">pynacl&amp;rsquo;s documentation&lt;/a> and use it directly.&lt;/p></description></item><item><title>Setting up unattended upgrades on Debian</title><link>https://valh.io/p/setting-up-unattended-upgrades-on-debian/</link><pubDate>Sat, 25 Aug 2018 12:30:21 +0000</pubDate><guid>https://valh.io/p/setting-up-unattended-upgrades-on-debian/</guid><description>
&lt;h1 id="why">Why&lt;/h1>
&lt;p>I have a Raspberry Pi running on Raspbian in my home network. It mainly provides a DNS server based on &lt;a href="https://pi-hole.net/">Pi Hole&lt;/a> and runs some cronjobs for me.
Of course you don&amp;rsquo;t want to login to such a system regularly and install package upgrades. That&amp;rsquo;s where unattended upgrades come into play.
I&amp;rsquo;ll tell you how to set unattended upgrades up on Debian and walk you through some config parameters that I find very useful.&lt;/p>
&lt;h1 id="how">How&lt;/h1>
&lt;p>Firstly, you need to install the unattended-upgrades pkg:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">apt install unattended-upgrades
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>unattended-upgrades is run automatically by the cronjob &lt;em>/etc/cron.daily/apt-compat&lt;/em>.&lt;/p>
&lt;h2 id="the-config-file">The config file&lt;/h2>
&lt;p>Now let&amp;rsquo;s have a look at the config file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vim /etc/apt/apt.conf.d/50unattended-upgrades
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The config file might look a bit messy at first due to a LOT of comments and the (in my opinion) unaesthetic apt config syntax.
The most interesting part to begin with is the &amp;ldquo;Origins-Pattern&amp;rdquo;:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">Unattended-Upgrade::Origins-Pattern {
&amp;#34;o=Debian,a=stable&amp;#34;;
&amp;#34;o=Debian,a=stable-updates&amp;#34;;
&amp;#34;o=Debian,a=proposed-updates&amp;#34;;
&amp;#34;origin=Debian,codename=${distro_codename},label=Debian-Security&amp;#34;;
};
&lt;/code>&lt;/pre>&lt;h2 id="defining-package-origins">Defining package origins&lt;/h2>
&lt;p>The Origins-Pattern defines from where unattended-upgrades will install upgrades. If an origin is missing here, package upgrades from there will be ignored. Which origins to configure here is totally up to you of course. Maybe you have installed some exotic PPA, which you always want to upgrade manually?
To find out how to configure the origins you want, you can have a look at apt&amp;rsquo;s lists:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">val@pi:~ $ ls /var/lib/apt/lists/ &lt;span class="p">|&lt;/span> grep InRelease
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">archive.raspberrypi.org_debian_dists_stretch_InRelease
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">raspbian.raspberrypi.org_raspbian_dists_stretch_InRelease
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>These InRelease files provide the information you need. To find out their origin and suite (o= and a=), use the grep command:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">val@pi:~ $ grep -E &lt;span class="s1">&amp;#39;(Origin|Suite)&amp;#39;&lt;/span> /var/lib/apt/lists/archive.raspberrypi.org_debian_dists_stretch_InRelease
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin: Raspberry Pi Foundation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Suite: stable
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So the origin of this particular apt list is &amp;ldquo;Raspberry Pi Foundation&amp;rdquo; and it&amp;rsquo;s suite is &amp;ldquo;stable&amp;rdquo;. To configure this for unattended-upgrades, you&amp;rsquo;d adapt the config to look as follows:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">Unattended-Upgrade::Origins-Pattern {
&amp;#34;o=Raspberry Pi Foundation,a=stable&amp;#34;;
&amp;#34;o=Raspbian,a=stable&amp;#34;;
&amp;#34;o=Debian,a=stable&amp;#34;;
&amp;#34;o=Debian,a=stable-updates&amp;#34;;
&amp;#34;o=Debian,a=proposed-updates&amp;#34;;
&amp;#34;origin=Debian,codename=${distro_codename},label=Debian-Security&amp;#34;;
};
&lt;/code>&lt;/pre>&lt;h2 id="defining-package-blacklist">Defining package blacklist&lt;/h2>
&lt;p>If you don&amp;rsquo;t want to upgrade certain packages from a defined origin automatically, you can put them in the blacklist, that should already be in the config file:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">Unattended-Upgrade::Package-Blacklist {
// &amp;#34;vim&amp;#34;;
// &amp;#34;libc6&amp;#34;;
// &amp;#34;libc6-dev&amp;#34;;
// &amp;#34;libc6-i686&amp;#34;;
};
&lt;/code>&lt;/pre>&lt;h2 id="automatically-remove-unused-dependencies-autoremove">Automatically remove unused dependencies (autoremove)&lt;/h2>
&lt;p>To automatically remove unused dependencies, set the following config parameter to true:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">Unattended-Upgrade::Remove-Unused-Dependencies &amp;#34;false&amp;#34;;
&lt;/code>&lt;/pre>&lt;h2 id="automatically-reboot">Automatically reboot&lt;/h2>
&lt;p>Some packages require a reboot. You probably want to control when that happens. In my case the pi reboots at 2 AM, when everyone&amp;rsquo;s usually asleep, if needed.&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">Unattended-Upgrade::Automatic-Reboot-Time &amp;#34;02:00&amp;#34;;
&lt;/code>&lt;/pre>&lt;h1 id="debugging">Debugging&lt;/h1>
&lt;p>unattended-upgrades offers a debug parameter, that makes debugging very easy. With &lt;em>&amp;ndash;apt-debug&lt;/em> and &lt;em>&amp;ndash;verbose&lt;/em> you can get even more debug output.
To debug previous runs of unattended-upgrades, check the log files: &lt;em>/var/log/unattended-upgrades/unattended-upgrades.log&lt;/em> and &lt;em>/var/log/unattended-upgrades/unattended-upgrades-dpkg.log&lt;/em>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">val@pi:~ $ sudo unattended-upgrades --dry-run --debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo: unable to resolve host pi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Initial blacklisted packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Initial whitelisted packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Starting unattended upgrades script
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Allowed origins are: &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;o=Raspberry Pi Foundation,a=stable&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;o=Raspbian,a=stable&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;o=Debian,a=stable&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;o=Debian,a=stable-updates&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;o=Debian,a=proposed-updates&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;origin=Debian,codename=stretch,label=Debian-Security&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Userscript to hide YouTube comments</title><link>https://valh.io/p/userscript-to-hide-youtube-comments/</link><pubDate>Sat, 17 Mar 2018 20:01:00 +0000</pubDate><guid>https://valh.io/p/userscript-to-hide-youtube-comments/</guid><description>
&lt;h1 id="why">Why&lt;/h1>
&lt;p>Most comments below YouTube videos are, well, irrelevant, to say the least.
Since they&amp;rsquo;re pretty much in the middle of the page, they still regularly caught my eyes and distracted me when I was checking the recommended videos and scrolled down the site.
That&amp;rsquo;s why I built a little userscript to hide the comments by default and make them visible with the click of a button.&lt;/p>
&lt;h1 id="installing-the-script">Installing the script&lt;/h1>
&lt;h2 id="chrome">Chrome&lt;/h2>
&lt;p>Just &lt;a href="https://github.com/va1entin/configs/raw/master/userscripts/hide-yt-comments.user.js">download the script&lt;/a> by right-clicking and selecting &lt;em>Save link as&lt;/em>. Open &lt;code>chrome://extensions&lt;/code> and drag-and-drop the file into Chrome. Chrome should ask, if you want to install it. You can also disable or remove it here.&lt;/p>
&lt;p>Alternatively, you can also use a dedicated userscript manager from the Chrome web store. Read the paragraph on Firefox, to learn how to install the script in such a manager.&lt;/p>
&lt;h2 id="firefox-and-others">Firefox and others&lt;/h2>
&lt;p>Firefox requires you to install a userscript manager add-on. One of the most famous ones is Greasemonkey.
I&amp;rsquo;m using a relatively new add-on called &lt;a href="https://addons.mozilla.org/de/firefox/addon/tampermonkey/">Tampermonkey&lt;/a>, though, because it is available across different browsers and also offers a nice configuration interface with a built-in editor.
Feel free to use whatever you want. I&amp;rsquo;ll describe how to install the script in Tampermonkey here.&lt;/p>
&lt;p>After Tampermonkey is installed, click on the following link. Tampermonkey should ask, if you want to install the script: &lt;a href="https://github.com/va1entin/configs/raw/master/userscripts/hide-yt-comments.user.js">Click to install&lt;/a>&lt;/p>
&lt;h1 id="using-the-script">Using the script&lt;/h1>
&lt;p>With the script enabled, comments will be hidden by default.&lt;/p>
&lt;p>You can make them visible by &lt;strong>clicking the button&lt;/strong> &lt;em>Show&lt;/em> and &lt;strong>scrolling a little&lt;/strong>.&lt;/p>
&lt;p>&lt;img src="https://valh.io/img/posts/yt-comments-userscript.webp" alt="Userscript to hide YouTube comments">&lt;/p>
&lt;p>You can also easily modify the texts on the buttons. Just open the script and change the two values of the two variables at the very top as you wish.&lt;/p>
&lt;h1 id="source-code">Source code&lt;/h1>
&lt;p>The source is &lt;a href="https://github.com/va1entin/configs/raw/master/userscripts/hide-yt-comments.user.js">available on GitHub.&lt;/a>&lt;/p></description></item><item><title>How to play YouTube in background on mobile</title><link>https://valh.io/p/how-to-play-youtube-in-background-on-mobile/</link><pubDate>Mon, 05 Mar 2018 21:14:00 +0000</pubDate><guid>https://valh.io/p/how-to-play-youtube-in-background-on-mobile/</guid><description>
&lt;p>One of the most requested features for mobile devices in, well, forever, is playing YouTube videos without having the app in foreground. YouTube introduced this feature with YouTube Red for paying customers. So if you&amp;rsquo;re lucky enough to live in one of the countries, where you can actually subscribe to YouTube Red, you can pay a few bucks per month to get this.&lt;/p>
&lt;p>If you&amp;rsquo;re not so lucky (like me) or just don&amp;rsquo;t want to pay, you could still use a mobile browser. Until recently at least, when YouTube blocked playing videos without having the according tab open on mobile devices. This is accomplished by utilizing the so called page visibility and fullscreen API. This allows a webpage to check, if you&amp;rsquo;re &lt;em>actually&lt;/em> viewing the page.&lt;/p>
&lt;p>Luckily, &lt;a href="https://timdream.org/">Timothy Chien&lt;/a> built an add-on for Firefox that blocks these APIs and allows you to listen to YouTube videos with another tab open or Firefox in background entirely on mobile.&lt;/p>
&lt;p>Just download Firefox from your favourite app store, if you haven&amp;rsquo;t already, and visit &lt;a href="https://addons.mozilla.org/en-US/firefox/addon/video-background-play-fix">this page&lt;/a> to install the add-on.&lt;/p>
&lt;p>This way you don&amp;rsquo;t need to access YouTube in desktop mode, change your user-agent or do anything else.&lt;/p>
&lt;p>Also, the code for the add-on is &lt;a href="https://github.com/mozilla/video-bg-play">available on GitHub&lt;/a>. So feel free to contribute!&lt;/p></description></item><item><title>Fix NoScript 10 (Quantum) default settings</title><link>https://valh.io/p/fix-noscript-10-quantum-default-settings/</link><pubDate>Tue, 09 Jan 2018 18:01:00 +0000</pubDate><guid>https://valh.io/p/fix-noscript-10-quantum-default-settings/</guid><description>
&lt;p>The release of Firefox 57 was a major disruptive event in the Mozilla community. One of the major changes was the migration of add-ons away from XUL/XPCOM to WebExtensions. While this change makes it easier for developers to integrate their existing (Chrome) add-ons with Firefox, it also forced Firefox add-on developers to rewrite their entire add-ons from scratch. Some devs (like the very popular DownThemAll) were &lt;a href="https://www.downthemall.net/re-downthemall-and-webextensions-or-why-why-i-am-done-with-mozilla/">very frustrated&lt;/a> and abandoned decades of code and tens of thousands of users.&lt;/p>
&lt;p>Giorgio Maone, the developer of NoScript, one of the most famous and important add-ons, decided to not let his users down and migrated it to WebExtensions. The result is an entirely new UI and a whole new workflow. Being a NoScript user for about 10 years now, it took me quite some time to get used to everything but I managed to get used to the new NoScript.&lt;/p>
&lt;p>But there&amp;rsquo;s one thing I didn&amp;rsquo;t get used to: the new default settings.&lt;/p>
&lt;p>The new NoScript comes with quite a lot of websites, that are fully trusted by default. Some of these might be totally rational to &lt;strong>most&lt;/strong> users (google.com, youtube.com, etc&amp;hellip;), others not so much (wlxrs.com, a parked domain, as far as I can tell). Nonetheless, I don&amp;rsquo;t want NoScript to decide who I, as it&amp;rsquo;s user, trust.
Another weird default setting are the &amp;ldquo;default&amp;rdquo; permissions for websites. There are 3 primary states: Default, Trusted and Untrusted.&lt;/p>
&lt;p>&lt;em>Default&lt;/em> = frames, fetch, &amp;ldquo;other&amp;rdquo;&lt;/p>
&lt;p>&lt;em>Trusted&lt;/em> = Anything&lt;/p>
&lt;p>&lt;em>Untrusted&lt;/em> = Nothing&lt;/p>
&lt;p>Since every site, that is not explicitly &lt;em>trusted&lt;/em> or &lt;em>untrusted&lt;/em>, gets assigned the &amp;ldquo;&lt;em>default&lt;/em>&amp;rdquo; state, it is allowed to do &lt;strong>some things&lt;/strong> and it&amp;rsquo;s not even entirely clear what these are (&amp;ldquo;other&amp;rdquo;).&lt;/p>
&lt;p>So I modified the default config, to not allow anything by default and also not trust or untrust any website. You can import this config either by downloading &lt;a href="https://valh.io/attachments/noscript_clean_config.txt">this file&lt;/a> and using the &lt;em>import&lt;/em> button on the NoScript options page to upload it or by copy pasting the following JSON into the text field that appears at the bottom of the page when the &amp;ldquo;Debug&amp;rdquo; checkbox is activated:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;DEFAULT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;capabilities&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;temp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;TRUSTED&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;capabilities&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;script&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;object&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;media&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;frame&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;font&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;webgl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;fetch&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;other&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;temp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;UNTRUSTED&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;capabilities&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;temp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sites&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;trusted&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;untrusted&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;custom&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;temp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;enforced&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;autoAllowTop&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Generating CPU load on Windows</title><link>https://valh.io/p/generating-cpu-load-on-windows/</link><pubDate>Tue, 19 Dec 2017 17:27:20 +0000</pubDate><guid>https://valh.io/p/generating-cpu-load-on-windows/</guid><description>
&lt;p>I recently wanted to check, if there was a problem with my CPU under heavy load, when running on Windows. For such purposes &lt;a href="http://download.sysinternals.com/files/CPUSTRES.zip">CPUSTRES.exe from the Sysinternals suite&lt;/a> is very helpful.&lt;/p>
&lt;p>CPUSTRES is a handy little tool to check your process for faults on heavy load.
It comes with a simple GUI and allows you to instantly put heavy CPU load on your system.&lt;/p>
&lt;p>CPUSTRES comes as a simple standalone program with a GUI and 4 threads to activate. You can also assign different intesities per thread. Task manager helps checking how much load is actually put on the CPU.&lt;/p>
&lt;p>&lt;img src="https://valh.io/img/posts/cpustres.webp" alt="CPUSTRES screenshot">&lt;/p></description></item><item><title>First post</title><link>https://valh.io/p/first-post/</link><pubDate>Sat, 14 Oct 2017 13:36:40 +0000</pubDate><guid>https://valh.io/p/first-post/</guid><description>
&lt;h1 id="this-is-a-test">This is a test&lt;/h1>
&lt;p>Welcome!&lt;/p>
&lt;h2 id="2nd-level-headline">2nd level headline&lt;/h2>
&lt;h3 id="3rd-level-headline">3rd level headline&lt;/h3></description></item></channel></rss>