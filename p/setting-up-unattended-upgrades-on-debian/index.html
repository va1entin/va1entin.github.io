<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Why I have a Raspberry Pi running on Raspbian in my home network. It mainly provides a DNS server based on Pi Hole and runs some cronjobs for me. Of course you don&rsquo;t want to login to such a system regularly and install package upgrades. That&rsquo;s where unattended upgrades come into play. I&rsquo;ll tell you how to set unattended upgrades up on Debian and walk you through some config parameters that I find very useful.
"><meta name=author content="Valentin Heidelberger"><link rel=canonical href=https://valh.io/p/setting-up-unattended-upgrades-on-debian/><link rel=icon type=image/x-icon href=/img/favicon.ico><title>Setting up unattended upgrades on Debian</title>
<link rel=stylesheet href=/css/styles.css><link rel=stylesheet href=/css/syntax.css><link id=custom_css href=/css/custom.css rel=stylesheet><link id=dark_css href=/css/dark.css rel=stylesheet><link href=/css/webfonts/fontawesome.min.css rel=stylesheet><link href=/css/webfonts/brands.min.css rel=stylesheet><link href=/css/webfonts/solid.min.css rel=stylesheet><link href=/css/webfonts/regular.min.css rel=stylesheet></head><body><nav class="navbar navbar-expand-lg navbar-light" id=mainNav><div class="container px-4 px-lg-5"><a class=navbar-brand href=/index.html>Valentin Heidelberger</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarResponsive aria-controls=navbarResponsive aria-expanded=false aria-label="Toggle navigation">
Menu
<i class="fas fa-bars"></i></button><div class="collapse navbar-collapse" id=navbarResponsive><ul class="navbar-nav ms-auto py-4 py-lg-0"><li class=nav-item><a class="nav-link px-lg-3 py-3 py-lg-4" title=Blog href=/index.html><span class="fa fa-book-open"></span>
<span>Blog</span></a></li><li class=nav-item><a href=/search/ class="nav-link px-lg-3 py-3 py-lg-4" title=Search><span class="fa fa-search nav-search-icon"></span>
<span>Search</span></a></li></ul></div></div></nav><header class=masthead style=background-image:url(/img/tags/linux.webp)><div class="container position-relative px-4 px-lg-5"><div class="row gx-4 gx-lg-5 justify-content-center"><div class="col-md-10 col-lg-8 col-xl-7"><div class=post-heading><h1>Setting up unattended upgrades on Debian</h1><h2 class=subheading></h2><span class=meta>Posted on August 25, 2018</span>
<span class=meta>Tags:
<a href=/tags/technology>#technology
</a><a href=/tags/linux>#linux</a></span></div></div></div></div></header><article class=mb4><aside id=custom_toc><nav id=TableOfContents><ul><li><a href=#why>Why</a></li><li><a href=#how>How</a><ul><li><a href=#the-config-file>The config file</a></li><li><a href=#defining-package-origins>Defining package origins</a></li><li><a href=#defining-package-blacklist>Defining package blacklist</a></li><li><a href=#automatically-remove-unused-dependencies-autoremove>Automatically remove unused dependencies (autoremove)</a></li><li><a href=#automatically-reboot>Automatically reboot</a></li></ul></li><li><a href=#debugging>Debugging</a></li></ul></nav></aside><div class="container px-4 px-lg-5"><div class="row gx-4 gx-lg-5 justify-content-center"><div class="col-md-10 col-lg-8 col-xl-7"><h1 id=why>Why</h1><p>I have a Raspberry Pi running on Raspbian in my home network. It mainly provides a DNS server based on <a href=https://pi-hole.net/>Pi Hole</a> and runs some cronjobs for me.
Of course you don&rsquo;t want to login to such a system regularly and install package upgrades. That&rsquo;s where unattended upgrades come into play.
I&rsquo;ll tell you how to set unattended upgrades up on Debian and walk you through some config parameters that I find very useful.</p><h1 id=how>How</h1><p>Firstly, you need to install the unattended-upgrades pkg:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt install unattended-upgrades
</span></span></code></pre></div><p>unattended-upgrades is run automatically by the cronjob <em>/etc/cron.daily/apt-compat</em>.</p><h2 id=the-config-file>The config file</h2><p>Now let&rsquo;s have a look at the config file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/apt/apt.conf.d/50unattended-upgrades
</span></span></code></pre></div><p>The config file might look a bit messy at first due to a LOT of comments and the (in my opinion) unaesthetic apt config syntax.
The most interesting part to begin with is the &ldquo;Origins-Pattern&rdquo;:</p><pre tabindex=0><code class=language-conf data-lang=conf>Unattended-Upgrade::Origins-Pattern {
      &#34;o=Debian,a=stable&#34;;
      &#34;o=Debian,a=stable-updates&#34;;
      &#34;o=Debian,a=proposed-updates&#34;;
      &#34;origin=Debian,codename=${distro_codename},label=Debian-Security&#34;;
};
</code></pre><h2 id=defining-package-origins>Defining package origins</h2><p>The Origins-Pattern defines from where unattended-upgrades will install upgrades. If an origin is missing here, package upgrades from there will be ignored. Which origins to configure here is totally up to you of course. Maybe you have installed some exotic PPA, which you always want to upgrade manually?
To find out how to configure the origins you want, you can have a look at apt&rsquo;s lists:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>val@pi:~ $ ls /var/lib/apt/lists/ <span class=p>|</span> grep InRelease
</span></span><span class=line><span class=cl>archive.raspberrypi.org_debian_dists_stretch_InRelease
</span></span><span class=line><span class=cl>raspbian.raspberrypi.org_raspbian_dists_stretch_InRelease
</span></span></code></pre></div><p>These InRelease files provide the information you need. To find out their origin and suite (o= and a=), use the grep command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>val@pi:~ $ grep -E <span class=s1>&#39;(Origin|Suite)&#39;</span> /var/lib/apt/lists/archive.raspberrypi.org_debian_dists_stretch_InRelease
</span></span><span class=line><span class=cl>Origin: Raspberry Pi Foundation
</span></span><span class=line><span class=cl>Suite: stable
</span></span></code></pre></div><p>So the origin of this particular apt list is &ldquo;Raspberry Pi Foundation&rdquo; and it&rsquo;s suite is &ldquo;stable&rdquo;. To configure this for unattended-upgrades, you&rsquo;d adapt the config to look as follows:</p><pre tabindex=0><code class=language-conf data-lang=conf>Unattended-Upgrade::Origins-Pattern {
      &#34;o=Raspberry Pi Foundation,a=stable&#34;;
      &#34;o=Raspbian,a=stable&#34;;
      &#34;o=Debian,a=stable&#34;;
      &#34;o=Debian,a=stable-updates&#34;;
      &#34;o=Debian,a=proposed-updates&#34;;
      &#34;origin=Debian,codename=${distro_codename},label=Debian-Security&#34;;
};
</code></pre><h2 id=defining-package-blacklist>Defining package blacklist</h2><p>If you don&rsquo;t want to upgrade certain packages from a defined origin automatically, you can put them in the blacklist, that should already be in the config file:</p><pre tabindex=0><code class=language-conf data-lang=conf>Unattended-Upgrade::Package-Blacklist {
//      &#34;vim&#34;;
//      &#34;libc6&#34;;
//      &#34;libc6-dev&#34;;
//      &#34;libc6-i686&#34;;
};
</code></pre><h2 id=automatically-remove-unused-dependencies-autoremove>Automatically remove unused dependencies (autoremove)</h2><p>To automatically remove unused dependencies, set the following config parameter to true:</p><pre tabindex=0><code class=language-conf data-lang=conf>Unattended-Upgrade::Remove-Unused-Dependencies &#34;false&#34;;
</code></pre><h2 id=automatically-reboot>Automatically reboot</h2><p>Some packages require a reboot. You probably want to control when that happens. In my case the pi reboots at 2 AM, when everyone&rsquo;s usually asleep, if needed.</p><pre tabindex=0><code class=language-conf data-lang=conf>Unattended-Upgrade::Automatic-Reboot-Time &#34;02:00&#34;;
</code></pre><h1 id=debugging>Debugging</h1><p>unattended-upgrades offers a debug parameter, that makes debugging very easy. With <em>&ndash;apt-debug</em> and <em>&ndash;verbose</em> you can get even more debug output.
To debug previous runs of unattended-upgrades, check the log files: <em>/var/log/unattended-upgrades/unattended-upgrades.log</em> and <em>/var/log/unattended-upgrades/unattended-upgrades-dpkg.log</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>val@pi:~ $ sudo unattended-upgrades --dry-run --debug
</span></span><span class=line><span class=cl>sudo: unable to resolve host pi
</span></span><span class=line><span class=cl>Initial blacklisted packages:
</span></span><span class=line><span class=cl>Initial whitelisted packages:
</span></span><span class=line><span class=cl>Starting unattended upgrades script
</span></span><span class=line><span class=cl>Allowed origins are: <span class=o>[</span><span class=s1>&#39;o=Raspberry Pi Foundation,a=stable&#39;</span>, <span class=s1>&#39;o=Raspbian,a=stable&#39;</span>, <span class=s1>&#39;o=Debian,a=stable&#39;</span>, <span class=s1>&#39;o=Debian,a=stable-updates&#39;</span>, <span class=s1>&#39;o=Debian,a=proposed-updates&#39;</span>, <span class=s1>&#39;origin=Debian,codename=stretch,label=Debian-Security&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><br></div></div></div></article><footer class=border-top><div class="container px-4 px-lg-5"><div class="row gx-4 gx-lg-5 justify-content-center"><div class="col-md-10 col-lg-8 col-xl-7"><ul class="list-inline text-center"><li class=list-inline-item><a href=/index.xml target=_blank><span class="fa-stack fa-lg"><i class="far fa-circle fa-stack-2x"></i>
<i class="fa fa-rss fa-stack-1x"></i></span></a></li><li class=list-inline-item><a href=https://github.com/va1entin target=_blank><span class="fa-stack fa-lg"><i class="far fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x"></i></span></a></li><li class=list-inline-item><a href=https://gitlab.com/va1entin target=_blank><span class="fa-stack fa-lg"><i class="far fa-circle fa-stack-2x"></i>
<i class="fab fa-gitlab fa-stack-1x"></i></span></a></li><li class=list-inline-item><a href=https://www.linkedin.com/in/va1entin target=_blank><span class="fa-stack fa-lg"><i class="far fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x"></i></span></a></li><div class="small text-center text-muted fst-italic"><br><br><a rel=license href=http://creativecommons.org/licenses/by/4.0/ target=_blank>CC-BY 4.0 International</a> Valentin Heidelberger 2017 - 2024<br>This applies to the contents of my blog and other texts on this site only.<br><a href=/terms-of-use>Terms of use</a><br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></div></ul><br><br></div></div></div></footer><script src=/js/bootstrap.bundle.min.js></script><script src=/js/scripts.js></script></body></html>